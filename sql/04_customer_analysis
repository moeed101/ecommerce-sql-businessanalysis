-- Top customers by revenue
SELECT
  customer_id,
  ROUND(SUM(quantity * unit_price), 2) AS total_revenue
FROM clean_orders
GROUP BY customer_id
ORDER BY total_revenue DESC
LIMIT 10;

-- Repeat vs one-time customers
SELECT
  CASE 
    WHEN order_count = 1 THEN 'One-time'
    ELSE 'Repeat'
  END AS customer_type,
  COUNT(*) AS customers
FROM (
  SELECT
    customer_id,
    COUNT(DISTINCT invoice_no) AS order_count
  FROM clean_orders
  GROUP BY customer_id
) t
GROUP BY customer_type;

-- Revenue split by customer type
SELECT
  CASE 
    WHEN order_count = 1 THEN 'One-time'
    ELSE 'Repeat'
  END AS customer_type,
  ROUND(SUM(revenue), 2) AS total_revenue
FROM (
  SELECT
    customer_id,
    COUNT(DISTINCT invoice_no) AS order_count,
    SUM(quantity * unit_price) AS revenue
  FROM clean_orders
  GROUP BY customer_id
) t
GROUP BY customer_type;
